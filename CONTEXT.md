Certo. Tudo ficou mais claro agora.

Agora preciso de ajudar para elencar todas as possíveis Fases que um projeto pode ter.

Lembrando que por Projeto nós consideramos todo tipo de serviço relacionado à um imóvel.

Pode ser apenas projeto arquitetônico, pode ser fundamento, pode ser uma reforma, pode ser a construção de um prédio, pode ser um condomínio. Então precisamos de várias opções de Fases para que em qualquer situação tenhamos uma opção que cubra o que é necessário. Mas caso seja alguma opção muito específica, tambem devemos permitir criar uma Fase customizada, onde o nome pode ser escolhido manualmente.

---

Perfeito. Vamos entregar um “catálogo de Fases” simples e abrangente, com templates por tipo de projeto e sempre permitindo fases customizadas. A lógica de progresso permanece: % da fase = média simples das tarefas; % do projeto = média simples das fases ativas.

Modelo de uso

- Na criação do projeto: usuário escolhe um template de fases (ou “vazio”) e pode editar/renomear. Fases customizadas são permitidas a qualquer momento.

- Fases têm status: Ativa, Rascunho, Arquivada. Só Ativas entram no cálculo.

Conjunto “Universal” (recomendado para maioria dos casos)

- Planejamento e Projeto

- Preparação/Canterização (mobilização, proteções, ligações provisórias)

- Fundação

- Estrutura

- Vedações/Alvenaria

- Instalações (agrupadas)

- Elétrica | Hidráulica/Sanitária | Gás | HVAC | Incêndio | Dados/Telefonia/SPDA (podem ser subfases ou tarefas)

- Esquadrias e Fachada

- Acabamentos Internos

- Áreas Externas/Paisagismo

- Comissionamento e Entrega

- Pós‑obra/Garantia

Biblioteca ampliada (para projetos que exigem mais granularidade)

Pré‑obra e Documentação

- Briefing/Programa de necessidades

- Levantamento/As‑built

- Estudo preliminar

- Anteprojeto

- Projeto legal e Aprovações (prefeitura, condomínio)

- Projeto executivo e Compatibilização (BIM)

- Orçamento/Planejamento/Compras

- Licenças/ART-RRT/Seguros/SST

Terreno/Preparação

- Demolição/Remoções

- Limpeza, Topografia, Sondagem/Geotecnia

- Terraplenagem/Movimentação de terra

- Drenagem provisória

- Tapumes e Canteiro

- Ligações provisórias (água, energia, esgoto)

Fundações

- Estacas/Estaqueamento

- Blocos/Sapatas/Radier

- Vigas baldrame

- Impermeabilização das fundações

Estrutura

- Concreto armado (pilares, vigas, lajes)

- Estrutura metálica

- Alvenaria estrutural

- Núcleo/Escadas/Poço de elevador

- Pré-moldados

Vedações e Coberturas

- Alvenaria de vedação

- Drywall/divisórias leves

- Cobertura (estrutura, telhamento, calhas/rufos)

- Impermeabilizações (lajes, áreas molhadas)

Instalações (caso queira detalhar em fases separadas)

- Elétrica/Quadros/Iluminação

- Hidráulica/Água fria e quente

- Esgoto/Drenagem

- Gás

- HVAC/Ar condicionado

- Sistema de incêndio (hidrantes, sprinklers)

- SPDA/Para‑raios

- Dados/Telefonia/CFTV/Automação

- Energia solar/geração, Bombas/Reservatórios

Esquadrias e Fachadas

- Metais/Alumínio/PVC

- Vidros/Pele de vidro

- Revestimento de fachada

- Pintura externa

Acabamentos internos

- Revestimentos argamassados (chapisco, emboço, massa)

- Revestimentos de paredes (cerâmica, pedras)

- Pisos (porcelanato, vinílico, laminado, madeira)

- Forros (gesso, metálico)

- Pintura interna

- Marcenaria/Mobiliário fixo

- Louças, metais, acessórios

- Guarda‑corpos/rodapés/soleiras

Externo e Urbanização

- Pavimentação/Estacionamentos

- Drenagem definitiva

- Muros, grades, portões

- Iluminação externa

- Paisagismo/Jardinagem

- Áreas comuns (playground, quadras, piscina)

Comissionamento e Entrega

- Testes/Start‑up de instalações

- Limpeza final

- Vistorias/Checklists (punch list)

- AVCB/Habite‑se/Laudos

- Manual/treinamento do usuário

- Entrega

Pós‑obra

- Correções de pendências

- Garantia e pós‑ocupação

Templates prontos por tipo de projeto (para reduzir passos)

1) Projeto Arquitetônico/Legal (somente serviços)

- Briefing → Levantamento/As‑built → Estudo preliminar → Anteprojeto → Projeto legal → Projeto executivo/Compatibilização → Orçamento → Entrega de projeto/As‑built

2) Reforma Residencial/Comercial

- Planejamento → Proteções/Canteiro → Demolições → Remanejamento de instalações → Novas vedações → Instalações → Acabamentos → Marcenaria → Limpeza/Entrega → Pós‑obra

3) Obra Nova (casa/prédio/sala comercial)

- Planejamento → Preparação/Terreno → Fundação → Estrutura → Vedações → Instalações → Esquadrias/Fachada → Acabamentos → Externo/Paisagismo → Comissionamento/Entrega → Pós‑obra

4) Interior Fit‑Out Corporativo

- Levantamento/Projeto → Demolições → Piso/Forros → Elétrica/Dados/HVAC → Divisórias → Acabamentos → Mobiliário/Marcenaria → TI/Automação → Comissionamento/Entrega

5) Condomínio/Loteamento

- Licenças/Projetos → Terraplenagem macro → Infra (água/esgoto/energia/telecom) → Drenagem/Vias/Pavimentação → Portaria/Segurança → Áreas comuns → Paisagismo/Sinalização → Comissionamento/Entrega

6) Regularização/Compliance

- Diagnóstico documental → Projetos/adequações → Aprovações/licenças → Adequações em campo → Vistorias/Laudos → Emissão (Habite‑se/AVCB) → Encerramento

Como manter simples e flexível

- Sempre permitir “Adicionar Fase customizada” (nome livre).

- Deixar um template “Essencial (8 fases)” como default; usuários avançados escolhem templates detalhados.

- Fases podem ser renomeadas/ocultadas (Rascunho) sem afetar dados; só “Ativas” entram no cálculo.

Boas práticas de UX

- Wizard de criação de projeto com: escolher template → editar lista → criar.

- Tooltips explicando cada fase (ex.: “Vedações: paredes internas e externas não estruturais”).

- Se o usuário pular as fases, mostrar banner “Defina as fases para calcular o progresso” e botão “Adicionar Fases”.

Teste rápido de cobertura

- Criar 1 projeto por tipo usando o template correspondente e verificar se todas as tarefas comuns do seu portfólio encaixam em alguma fase. Se não, crie/adicione ao catálogo.

- Medir adoção: % de projetos que ficam no template “Essencial” vs. detalhados; ajustar catálogo conforme feedback.

Próximos passos

- Publicar o “Catálogo de Fases” no backend como seeds de templates por tipo de projeto.

- No frontend, disponibilizar seleção de template com busca e pré‑visualização.

- Coletar telemetria de quais fases os usuários removem/adicionam para evoluir os templates.

---
Eu não entendi exatamente quais itens são Fases ou Tarefas.

Por exemplo no item Pós-obra. O Pós-obra é uma fase? E o item que está abaixo "Correções e pendências" é uma Fase também?

---

Ótima pergunta. Vamos alinhar a taxonomia e depois listo um catálogo claro.

Como separar Fase de Tarefa

- Fase

- Macroetapa do projeto (dura semanas/meses).

- Agrega várias tarefas.

- É o que aparece como linha no Cronograma e entra no cálculo da % do Projeto.

- Recomenda-se 5–12 fases ativas por projeto.

- Tarefa

- Ação executável e atribuível a 1 responsável (horas/dias).

- Move no Kanban (Backlog → Em andamento → Em revisão → Concluída).

- Pode ter checklist, anexos, comentários.

Resposta direta ao exemplo

- “Pós‑obra” é uma Fase.

- “Correções e pendências” (punch list) são Tarefas dentro dessa fase. Recomendo 1 tarefa “Gerar punch list” e depois N tarefas “Corrigir pendência X”, ou 1 tarefa “Executar punch list” com checklist dos itens.

Catálogo de Fases (universal, sem marcos)

Use como templates; sempre permita “Fase customizada”.

Template Essencial (9 fases) – cobre a maioria dos cenários

1) Planejamento e Projeto

- Exemplos de tarefas: Briefing; Levantamento/As‑built; Estudo preliminar; Projeto legal; Projeto executivo/compatibilização; Orçamento; Cronograma.

2) Preparação do Canteiro

- Tarefas: Tapumes/segurança; Ligações provisórias (água/energia); Logística/armazenamento; Proteções de áreas existentes.

3) Fundação

- Tarefas: Sondagem; Estacas; Blocos/sapatas/radier; Baldrames; Impermeabilização da fundação.

4) Estrutura

- Tarefas: Fôrmas; Armaduras; Concretagens (lajes/pilares/vigas); Escadas; Poço de elevador.

5) Vedações e Cobertura

- Tarefas: Alvenaria de vedação; Drywall/divisórias; Cobertura/estrutura; Telhamento; Calhas/rufos; Impermeabilizações de laje.

6) Instalações (agrupadas)

- Tarefas: Elétrica/quadros/iluminação; Hidráulica/água/esgoto; Gás; HVAC/ar‑condicionado; Incêndio; Dados/telefonia/CFTV/SPDA.

- Observação: para obras complexas, ver “Template Avançado”, onde cada sistema vira uma fase própria.

7) Esquadrias e Fachada

- Tarefas: Esquadrias (alumínio/PVC/madeiras); Vidros; Revestimento de fachada; Pintura externa.

8) Acabamentos Internos

- Tarefas: Revestimentos argamassados; Pisos; Revestimentos de parede; Forros; Pintura; Louças e metais; Marcenaria.

9) Comissionamento e Entrega

- Tarefas: Testes/start‑up instalações; Limpeza final; Vistorias/checklist; Correções finais; AVCB/Habite‑se; Manual e treinamento; Termo de recebimento.

Fase opcional (10ª) para continuidade

10) Pós‑obra

- Tarefas: Gerar punch list pós‑ocupação; Correções de pendências; Atendimentos em garantia; Encerramento.

Template Avançado (quando quiser mais controle)

- Igual ao Essencial, mas “Instalações” é dividido em fases distintas:

- Instalações Elétricas

- Instalações Hidráulicas/Sanitárias

- Gás

- HVAC/Climatização

- Incêndio

- Dados/Telefonia/CFTV/SPDA

- Cada uma com suas tarefas específicas (lançamento de tubulação, cabeamento, montagens, testes).

Templates por tipo de projeto (sugestão rápida)

- Projeto arquitetônico/regularização: Planejamento e Projeto → Aprovações/licenças → Projeto executivo/compatibilização → Orçamento → Entrega de projeto.

- Reforma: Planejamento → Preparação/Proteções → Demolições → Novas vedações → Instalações → Acabamentos → Comissionamento/Entrega → Pós‑obra.

- Loteamento/condomínio: Planejamento/licenças → Terraplenagem → Infra (água/esgoto/energia/telecom) → Drenagem/vias → Portaria/segurança → Áreas comuns → Paisagismo → Comissionamento/Entrega.

Regras práticas para manter simples

- Nome de Fase = substantivo curto (“Estrutura”, “Acabamentos”).

- Nome de Tarefa = verbo + objeto (“Concretar laje do 3º pavimento”).

- Fase sem tarefas: aparece com 0% e rótulo “sem tarefas”.

- Tarefas repetitivas por ambiente/unidade: use uma tarefa por “andar/unidade” com checklist dos ambientes (evita centenas de tarefas minúsculas).

Validação rápida

- Projeto com 9 fases; se só “Preparação do Canteiro” tiver 3 tarefas concluídas:

- Fase “Preparação” = média simples das tarefas (ex.: 100%).

- Projeto = média simples das 9 fases → ~11% (as demais = 0%). Não aparenta 100% no início.

Próximos passos

- Publicar os templates de fases (Essencial e Avançado) como seeds.

- No wizard de criação de projeto, permitir: escolher template → editar lista → adicionar Fase customizada.

- No Kanban, sempre exigir seleção de Fase ao criar Tarefa; se não houver, abrir mini‑wizard “Criar Fases”.

---

Certo, agora descreva o modelo das entidades Fase e Tarefa (atributos).

A entidade Projeto eu já tenho criado, imagino que não interfere em Fase e Tarefa, visto que essas dependerão de Projeto.

Lembrando que a porcentagem das Fases serão um método que vai buscar a porcentagem on the fly, ao inves de ter uma coluna na tabela.

---

Perfeito. Abaixo está o modelo funcional das entidades Fase e Tarefa, alinhado ao que definimos: sem pesos, cálculo de progresso on the fly, simples para leigos e útil para avançados.

Visão de relacionamento

- Project 1—N Phase

- Phase 1—N Task

- Task pode ter: Checklist items, Comentários, Anexos, Dependências, Assignees

Fase (Phase)

- Identificação e vínculo

- id

- company_id

- project_id

- Dados principais

- name (ex.: “Estrutura”)

- description (opcional)

- status: draft | active | archived

- Só active entra no cálculo do progresso do projeto

- sequence (ordem no cronograma)

- color (opcional, para UI)

- Planejamento e prazo (opcional)

- planned_start_at (date/datetime)

- planned_end_at (date/datetime)

- actual_start_at (preenchido quando a 1ª tarefa inicia; opcional)

- actual_end_at (quando todas as tarefas estão concluídas; opcional)

- Metadados e auditoria

- meta (json) — livre para flags futuras

- created_by, updated_by

- created_at, updated_at, deleted_at (soft delete)

Campos computados (retornados pela API; não persistidos)

- progress_percent

- Regra: média simples do progress_percent das tarefas da fase com status != canceled

- Se não houver tarefas, 0%

- schedule_status (no_prazo | em_risco | atrasado | sem_datas)

- Baseado em comparação linear tempo x progresso (se planned_start/end existirem)

- tasks_counts

- total, by_status (para UI)

- dates_status

- atraso_dias (se aplicável)

Tarefa (Task)

- Identificação e vínculo

- id

- company_id

- project_id

- phase_id

- Dados principais

- title (ex.: “Concretar laje do 3º pavimento”)

- description (opcional)

- status: backlog | in_progress | in_review | done | on_hold | canceled

- priority: low | medium | high | urgent (opcional)

- order_in_phase (para ordenar no Kanban/lista)

- Responsáveis

- assignee_id (User) — responsável principal (opcional)

- contractor_id (opcional; quando alocado a prestador)

- observers/watchers (N:N em tabela auxiliar; opcional)

- Prazo e datas

- planned_start_at (opcional)

- planned_end_at (opcional)

- due_at (alias prático do planned_end_at; opcional)

- started_at (setado ao mover para in_progress; opcional)

- completed_at (setado ao mover para done; opcional)

- Progresso (sem pesos)

- progress_manual (0–100, opcional)

- progress_source: checklist | manual | status_auto

- O sistema escolhe automaticamente:

- Se houver checklist items: checklist

- Senão, se progress_manual não for nulo: manual

- Caso contrário: status_auto

- Outros

- labels/tags (json, opcional)

- estimate_hours (opcional; não usado no cálculo, só referência)

- blocked_reason (opcional, se on_hold)

- Metadados e auditoria

- created_by, updated_by

- created_at, updated_at, deleted_at

Campos computados (retornados pela API; não persistidos)

- progress_percent

- checklist: done/total × 100

- manual: progress_manual

- status_auto (fallback):

- backlog = 0

- in_progress = 50

- in_review = 90

- done = 100

- on_hold = mantém último progress_percent calculado (ou 0 se inexistente)

- canceled = excluída de médias

- schedule_status (no_prazo | em_risco | atrasado | sem_datas)

- expected_by_time = ((hoje − planned_start) / (planned_end − planned_start)) × 100, clamp 0..100

- delta = progress_percent − expected_by_time

- atrasado: hoje > planned_end e progress < 100, ou delta < −20 pp

- em_risco: −20 ≤ delta < −10

- adiantado: delta > +10 (opcional)

- checklist_stats

- total_items, done_items (para UI rápida)

Regras de cálculo (on the fly)

- task_progress(task)

- ver “Campos computados” de Tarefa

- phase_progress(phase)

- média simples de task_progress das tarefas da fase com status != canceled

- sem tarefas → 0

- project_progress(project)

- média simples de phase_progress das fases status active do projeto

- sem fases ativas → “—/0”

Filtros, índices e consistência

- Índices úteis

- Phase: (project_id, status, sequence), (company_id, project_id)

- Task: (project_id, phase_id, status), (assignee_id), (planned_end_at)

- Policies

- Sempre filtrar por company_id e por project_id ao consultar fases/tarefas

- Consistência de estados

- Mover task para done seta completed_at

- Reabrir (done → in_review/in_progress) zera completed_at e mantém progress_manual se existir

- Tasks canceled não entram nos cálculos

Eventos e observabilidade

- Ao mudar status/datas/checklist da tarefa: evento TaskUpdated

- Consumers (jobs) podem apenas invalidar cache de agregados (Redis) para respostas rápidas, mas o cálculo permanece on the fly

- Telemetria: tempos médios de resposta dos endpoints agregados e contagem de recalculadas

Contratos de API (resumo do que retornar)

- GET /projects/{id}/phases

- id, name, status, planned_start/end, sequence, progress_percent (computado), schedule_status, tasks_counts

- GET /phases/{id}/tasks

- id, title, status, assignee, planned_start/end, due_at, progress_percent (computado), schedule_status, checklist_stats

- GET /projects/{id}/progress

- project_progress_percent (computado), phases_progress[] (id, name, progress_percent)

Validações principais

- Phase: name obrigatório; unique por project_id + name (opcional)

- Task: title obrigatório; phase_id obrigatório; status em enum; progress_manual entre 0 e 100 (se informado); planned_end_at >= planned_start_at (se ambos)

Casos de borda tratados

- Fase sem tarefas: 0% e label “sem tarefas”

- Tarefa on_hold: mantém % atual; entra no denominador da fase (reflete impacto)

- Tarefa canceled: excluída do cálculo

- Adição/remoção de fases active muda o % do projeto (escopo variou) — avisar na UI

Teste mínimo de aceitação

1) Projeto com 3 fases active; sem tarefas → project_progress = 0%

2) Fase A com 2 tarefas (100% e 50%) → phase A = 75%; projeto ≈ 25%

3) Tarefa on_hold mantendo 50% não distorce cálculo (continua 50%)

4) Tarefa canceled sai do cálculo da fase

5) Inserir datas e atrasar 1 tarefa → schedule_status reflete “atrasado”, sem alterar % físico

Isso mantém o modelo simples, coerente com as telas e pronto para evoluir (checklist, comentários, anexos, dependências) sem mudar a regra central de progresso.

---

Vamos simplificar um pouco e remover a possibilidade de checklist dentro da tarefa, mantendo o gerenciamento do progresso apenas através do status da tarefa.

Remova também estimate_hours de Tasks.

Remova também atributos relacionados a Metadados e auditoria, matendo apenas created, updated e deleted at.

Depois liste quais entidades faz sentido termos criadas primeiro, como por exemplo acredito que Contractor precisaria existir para termos o link com a Task.

---
Perfeito. Segue o modelo simplificado, sem checklist, sem horas estimadas e sem metadados extras. O progresso é 100% determinado pelo status da tarefa; Fase e Projeto calculam on the fly (sem coluna de %).

Status → % de progresso (fixo)

- backlog = 0

- in_progress = 50

- in_review = 90

- done = 100

- canceled = excluída de médias

Entidade Phase (Fase)

- id

- company_id

- project_id

- name (string)

- description (string, opcional)

- status (enum): draft | active | archived

- sequence (int) — ordem no cronograma

- color (string, opcional)

- planned_start_at (datetime, opcional)

- planned_end_at (datetime, opcional)

- actual_start_at (datetime, opcional)

- actual_end_at (datetime, opcional)

- created_at, updated_at, deleted_at

Computado pela API (sem persistir):

- progress_percent = média simples dos progress_percent das tasks da fase com status != canceled (se não houver tasks, 0)

- schedule_status (no_prazo | em_risco | atrasado | sem_datas) com base nas datas planned_* e no comparativo linear tempo × % (expected_by_time vs % atual)

- tasks_counts: total e por status

Entidade Task (Tarefa)

- id

- company_id

- project_id

- phase_id

- title (string)

- description (text, opcional)

- status (enum): backlog | in_progress | in_review | done | canceled

- priority (enum, opcional): low | medium | high | urgent

- order_in_phase (int) — ordenação no Kanban

- assignee_id (user, opcional)

- contractor_id (opcional) — vínculo com o prestador

- is_blocked (bool, default false) — não altera %, apenas sinaliza

- blocked_reason (string, opcional)

- planned_start_at (datetime, opcional)

- planned_end_at (datetime, opcional)

- due_at (datetime, opcional; alias prático de planned_end_at)

- started_at (datetime, opcional; setar ao ir para in_progress)

- completed_at (datetime, opcional; setar ao ir para done)

- created_at, updated_at, deleted_at

Computado pela API:

- progress_percent: mapeado pelo status (acima)

- schedule_status:

- expected_by_time = ((hoje − planned_start) / (planned_end − planned_start)) × 100 (clamp 0..100)

- delta = progress_percent − expected_by_time

- atrasado: (hoje > planned_end e progress < 100) ou delta < −20 pp

- em_risco: −20 ≤ delta < −10

- no_prazo: delta ≥ −10

- sem_datas: se faltar planned_start/end

Regras de cálculo

- phase_progress(phase) = média simples do % das tasks ativas (exclui canceled)

- project_progress(project) = média simples do phase_progress das fases status = active

- Fase sem tasks: 0% e “sem tarefas”

- Alterar status:

- backlog → in_progress → in_review → done (padrão)

- done pode reabrir para in_review ou in_progress (completed_at volta a null)

- canceled exclui do cálculo (pode reativar voltando o status; mantém datas planejadas)

Validações essenciais

- Phase: name obrigatório; planned_end_at ≥ planned_start_at (se ambos existir)

- Task: title e phase_id obrigatórios; status e priority nos enums; planned_end_at ≥ planned_start_at

Índices recomendados

- phases: (project_id, status, sequence), (company_id, project_id)

- tasks: (project_id, phase_id, status), (assignee_id), (contractor_id), (planned_end_at)

Ordem das entidades para criar primeiro (MVP operacional)

1) Phase — necessário para estruturar o projeto e calcular % do projeto.

2) Task — núcleo do Kanban/Cronograma e origem do progresso.

3) Contractor — para vincular tarefas a prestadores.

4) ProjectMember (ou ProjectUser) — vínculo usuário ↔ projeto com papel (se ainda não tiver); habilita assignee consistente.

5) Attachment (genérico) — anexar fotos/documentos a tarefas (se quiser já no MVP).

6) Comment — comunicação básica nas tarefas.

7) Notification — alertas por prazo (e-mail/push) com base em planned_end_at.

Teste mínimo (aceitação)

- Projeto com 3 fases active, sem tarefas → project_progress = 0%

- Fase A: tasks [done, in_progress] → % = (100 + 50)/2 = 75% → projeto ≈ 25%

- Cancelar uma task da Fase A → recalcula com as restantes

- Reabrir task done → completed_at = null; % da fase/projeto atualiza

- Vincular contractor a uma task e filtrar por contractor nas listas (valida o relacionamento)

Com isso você mantém o modelo simples e previsível, com progresso derivado apenas do status, e já prepara os vínculos essenciais (usuários e prestadores) para operação real.